## Настройка окружения для GitOps
Сначала запустим кластер **Kubernetes**. Для этого нужно дождаться выполнения команды:
`launch.sh`{{execute}}

Важным компонентом подхода GitOPS является сервис контроля версий Git, в котором совместно хранятся исходный код приложения, а также другие манифесты и конфигурационные файлы, необходимые для запуска приложения в среде Kubernetes. В качестве учебного примера такого сервиса мы будем использовать решение **Gogs** (https://gogs.io/). **Gogs** является легковестным open source аналогом GitHub.  

Для установки ***Gogs** запустим команду:
`kubectl apply -f gogs.yaml`{{execute}}  

Получим внешний IP-адрес службы Gogs:
`kubectl get svc gogs`{{execute}}

Далее необходимо создать нового пользователя в Gogs. Для этого в открытом терминале выполните следующую команду:

curl -X POST "http://$EXTERNAL_IP/api/v1/admin/users" -H "Content-Type: application/json" -d "{\"username\":\"Test\", \"password\":\"password1\"}"
где необходимо указать:
EXTERNAL_IP=<gogs_external_ip> // указать внешний IP-адрес службы Gogs

В результате выполнения этой команды, будет создан новый пользователь "Test" с паролем "password". 

Теперь необходимо создать удаленый репозиторий следующей командой в терминале:
curl -X POST "http://$EXTERNAL_IP/api/v1/user/repos" -H "Content-Type: application/json" -d "{\"username\":\"Test\", \"name\":\"test_repo\", \"private\": false}"

В результате выполнения этой команды будет создан новый репозиторий "test_repo".
На этом настройка сервиса Git репозитория для хранения исходного кода приложения считается завершенной.

Далее необходимо развернуть компоненты **Argo CD**.

Одним из популярных инструментов, используемых в GitOPS является **Argo CD**.
![Argo CD](./assets/gitops2.png)
**Argo CD** - это инструмент непрерывного развертывания (CD), ориентированный на Kubernetes. В отличие от внешних CD-инструментов, обеспечивающих только push-развертывание, Argo CD может отслеживать, автоматически извлекать обновленный код из Git-репозиториев и разворачивать его непосредственно на ресурсах Kubernetes. Это позволяет разработчикам управлять как конфигурацией инфраструктуры, так и обновлениями приложений в одной системе.

Когда происходит фиксация (обычно обновляющая версии артефактов образа), **Argo CD** запускает процесс «синхронизации», который отвечает за приведение конфигурации кластера в то же состояние, как описано в Git.

Когда процесс синхронизации завершен, мы знаем, что конфигурация приложения точно такая же, как в манифестах Git.

Несмотря на то, что процесс синхронизации жизненно важен для выполнения первоначального развертывания приложения, одной из сильных сторон **Argo CD** является непрерывный мониторинг обоих состояний (кластера и Git) *после* развертывания. Этот непрерывный мониторинг очень важен для решения проблемы дрейфа конфигурации, который является очень распространенной проблемой в организациях с большим количеством целей развертывания.

Создадим отдельный namespace:
`kubectl create namespace argocd`{{execute}}

Запустим установку необходимых компонентов **Argo СD**:
`kubectl apply -n argocd -f argocd.yaml`{{execute}}

Проверим текущий статус запуска все компонентов **Argo CD**
`kubectl get all -n argocd`{{execute}}

На этом предварительная настройка окружения завершена.





